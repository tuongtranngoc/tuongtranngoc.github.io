---
layout: archive
title: "CV"
permalink: /cv/
author_profile: true
---

{% include base_path %}

<div class="cv-actions">
  <a href="{{ base_path }}/cv/cv.pdf" download class="btn btn--info btn--small">Download PDF</a>
  <button id="cv-view-source" class="btn btn--success btn--small">View LaTeX Source</button>
</div>

<div class="cv-viewer">
  <div class="cv-viewer__controls" id="cv-controls">
    <button id="cv-prev" disabled>&laquo; Prev</button>
    <span id="cv-page-info">Loading...</span>
    <button id="cv-next" disabled>Next &raquo;</button>
    <button id="cv-zoom-out" title="Zoom out">&minus;</button>
    <button id="cv-zoom-in" title="Zoom in">+</button>
  </div>
  <div class="cv-viewer__canvas-container" id="cv-canvas-container">
    <canvas id="cv-canvas"></canvas>
    <noscript>
      <object data="{{ base_path }}/cv/cv.pdf" type="application/pdf" width="100%" height="800px">
        <p>Your browser does not support PDFs. <a href="{{ base_path }}/cv/cv.pdf">Download the PDF</a>.</p>
      </object>
    </noscript>
  </div>
</div>

<div class="cv-modal-overlay" id="cv-modal-overlay"></div>
<div class="cv-modal" id="cv-modal">
  <div class="cv-modal__header">
    <span>cv.tex</span>
    <button id="cv-modal-close">&times;</button>
  </div>
  <div class="cv-modal__body">
    <pre><code id="cv-source-code" class="language-latex"></code></pre>
  </div>
</div>

<script>
(function() {
  var pdfUrl = '{{ base_path }}/cv/cv.pdf';
  var texUrl = '{{ base_path }}/cv/cv.tex';
  var pdfDoc = null;
  var currentPage = 1;
  var currentScale = window.innerWidth < 600 ? 1.0 : 1.5;
  var canvas = document.getElementById('cv-canvas');
  var ctx = canvas.getContext('2d');
  var pageInfo = document.getElementById('cv-page-info');
  var prevBtn = document.getElementById('cv-prev');
  var nextBtn = document.getElementById('cv-next');
  var zoomInBtn = document.getElementById('cv-zoom-in');
  var zoomOutBtn = document.getElementById('cv-zoom-out');

  function renderPage(num) {
    pdfDoc.getPage(num).then(function(page) {
      var viewport = page.getViewport({ scale: currentScale });
      canvas.height = viewport.height;
      canvas.width = viewport.width;
      page.render({ canvasContext: ctx, viewport: viewport });
      pageInfo.textContent = num + ' / ' + pdfDoc.numPages;
      prevBtn.disabled = num <= 1;
      nextBtn.disabled = num >= pdfDoc.numPages;
    });
  }

  prevBtn.addEventListener('click', function() {
    if (currentPage > 1) { currentPage--; renderPage(currentPage); }
  });
  nextBtn.addEventListener('click', function() {
    if (pdfDoc && currentPage < pdfDoc.numPages) { currentPage++; renderPage(currentPage); }
  });
  zoomInBtn.addEventListener('click', function() {
    currentScale += 0.25;
    if (pdfDoc) renderPage(currentPage);
  });
  zoomOutBtn.addEventListener('click', function() {
    if (currentScale > 0.5) { currentScale -= 0.25; if (pdfDoc) renderPage(currentPage); }
  });

  // Poll for pdfjsLib availability (loaded via defer)
  var attempts = 0;
  var pollInterval = setInterval(function() {
    attempts++;
    if (typeof pdfjsLib !== 'undefined') {
      clearInterval(pollInterval);
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.worker.min.js';
      pdfjsLib.getDocument(pdfUrl).promise.then(function(pdf) {
        pdfDoc = pdf;
        renderPage(1);
      }).catch(function() {
        pageInfo.textContent = 'PDF not available';
      });
    } else if (attempts > 30) {
      clearInterval(pollInterval);
      // Fallback: replace canvas with object embed
      var container = document.getElementById('cv-canvas-container');
      container.innerHTML = '<object data="' + pdfUrl + '" type="application/pdf" width="100%" height="800px">' +
        '<p>PDF viewer unavailable. <a href="' + pdfUrl + '">Download the PDF</a>.</p></object>';
      pageInfo.textContent = 'Embedded view';
    }
  }, 100);

  // LaTeX source modal
  var modal = document.getElementById('cv-modal');
  var overlay = document.getElementById('cv-modal-overlay');
  var sourceCode = document.getElementById('cv-source-code');
  var fetched = false;

  function openModal() {
    if (!fetched) {
      fetch(texUrl).then(function(r) { return r.text(); }).then(function(text) {
        sourceCode.textContent = text;
        fetched = true;
        if (typeof Prism !== 'undefined') Prism.highlightElement(sourceCode);
      }).catch(function() {
        sourceCode.textContent = 'Failed to load source file.';
      });
    }
    modal.style.display = 'block';
    overlay.style.display = 'block';
  }

  function closeModal() {
    modal.style.display = 'none';
    overlay.style.display = 'none';
  }

  document.getElementById('cv-view-source').addEventListener('click', openModal);
  document.getElementById('cv-modal-close').addEventListener('click', closeModal);
  overlay.addEventListener('click', closeModal);
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closeModal();
  });
})();
</script>
