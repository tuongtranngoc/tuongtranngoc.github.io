---
layout: archive
title: "Running"
permalink: /running/
author_profile: true
---

{% include base_path %}

{% assign strava = site.data.strava %}
{% assign today  = strava.today %}

<p class="running-intro">
  I run to clear my head and stay consistent.
  Stats below are synced automatically from Strava every day.
</p>

<a href="https://www.strava.com/athletes/tuongtranngoc" target="_blank" rel="noopener" class="strava-btn">
  <i class="fab fa-strava" aria-hidden="true"></i> View on Strava
</a>

<!-- ─── Today's Stats ──────────────────────────────────────────────── -->
<h2>Today <small class="running-date">{{ today.date }}</small></h2>

<div class="running-stats">

  <div class="stat-card">
    <div class="stat-card__icon"><i class="fas fa-route" aria-hidden="true"></i></div>
    <div class="stat-card__value">{{ today.distance_km }}</div>
    <div class="stat-card__label">km today</div>
  </div>

  <div class="stat-card">
    <div class="stat-card__icon"><i class="fas fa-running" aria-hidden="true"></i></div>
    <div class="stat-card__value">{{ today.runs }}</div>
    <div class="stat-card__label">runs today</div>
  </div>

  <div class="stat-card">
    <div class="stat-card__icon"><i class="fas fa-mountain" aria-hidden="true"></i></div>
    <div class="stat-card__value">{{ today.elevation_m }}</div>
    <div class="stat-card__label">elevation (m)</div>
  </div>

  {% if today.runs > 0 and today.distance_km > 0 %}
    {% assign pace_s = today.moving_time_s | times: 1.0 | divided_by: today.distance_km %}
    {% assign pace_min = pace_s | divided_by: 60 | floor %}
    {% assign pace_sec = pace_s | modulo: 60 | round %}
    {% if pace_sec < 10 %}{% assign pace_sec_str = pace_sec | prepend: "0" %}{% else %}{% assign pace_sec_str = pace_sec | append: "" %}{% endif %}
    {% assign today_pace = pace_min | append: ":" | append: pace_sec_str %}
  {% else %}
    {% assign today_pace = "—" %}
  {% endif %}

  <div class="stat-card">
    <div class="stat-card__icon"><i class="fas fa-tachometer-alt" aria-hidden="true"></i></div>
    <div class="stat-card__value">{{ today_pace }}</div>
    <div class="stat-card__label">pace (min/km)</div>
  </div>

</div>

<!-- ─── Today's Map ───────────────────────────────────────────────── -->
{% if today.polylines.size > 0 %}
<div id="todayMap" class="running-today-map"></div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
(function () {
  var polylines = {{ today.polylines | jsonify }};

  function decodePolyline(str) {
    var i = 0, lat = 0, lng = 0, coords = [], b, shift, result;
    while (i < str.length) {
      shift = result = 0;
      do { b = str.charCodeAt(i++) - 63; result |= (b & 0x1F) << shift; shift += 5; } while (b >= 0x20);
      lat += (result & 1) ? ~(result >> 1) : (result >> 1);
      shift = result = 0;
      do { b = str.charCodeAt(i++) - 63; result |= (b & 0x1F) << shift; shift += 5; } while (b >= 0x20);
      lng += (result & 1) ? ~(result >> 1) : (result >> 1);
      coords.push([lat / 1e5, lng / 1e5]);
    }
    return coords;
  }

  function initMap() {
    if (typeof L === "undefined") { setTimeout(initMap, 100); return; }
    var map = L.map("todayMap", { zoomControl: true, scrollWheelZoom: false });
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      maxZoom: 18
    }).addTo(map);

    var allCoords = [];
    polylines.forEach(function (encoded) {
      var coords = decodePolyline(encoded);
      if (!coords.length) return;
      L.polyline(coords, { color: "#FC4C02", weight: 4, opacity: 0.85 }).addTo(map);
      L.circleMarker(coords[0], {
        radius: 6, fillColor: "#FC4C02", color: "#fff", weight: 2, fillOpacity: 1
      }).addTo(map);
      allCoords = allCoords.concat(coords);
    });

    if (allCoords.length) {
      map.fitBounds(allCoords, { padding: [24, 24] });
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initMap);
  } else {
    initMap();
  }
})();
</script>
{% endif %}

<!-- ─── Today's Photos ─────────────────────────────────────────────── -->
{% if today.photos.size > 0 %}
<div class="running-today-photos">
  {% for photo in today.photos %}
  <img src="{{ photo }}" alt="Activity photo" loading="lazy">
  {% endfor %}
</div>
{% endif %}

<!-- ─── Yearly Stats ──────────────────────────────────────────────── -->
{% if strava.yearly.size > 0 %}
<h2>Stats by Year</h2>
<div class="running-table-wrap">
  <table class="running-table">
    <thead>
      <tr>
        <th>Year</th>
        <th>Runs</th>
        <th>Distance</th>
        <th>Elevation</th>
        <th>Avg Pace</th>
      </tr>
    </thead>
    <tbody>
      {% for y in strava.yearly %}
        {% if y.runs > 0 and y.distance_km > 0 %}
          {% assign yps = y.moving_time_s | times: 1.0 | divided_by: y.distance_km %}
          {% assign ypm = yps | divided_by: 60 | floor %}
          {% assign ypsec = yps | modulo: 60 | round %}
          {% if ypsec < 10 %}{% assign ypsec_s = ypsec | prepend: "0" %}{% else %}{% assign ypsec_s = ypsec | append: "" %}{% endif %}
          {% assign ypace = ypm | append: "'" | append: ypsec_s | append: '"' %}
        {% else %}
          {% assign ypace = "—" %}
        {% endif %}
        <tr>
          <td data-label="Year"><strong>{{ y.year }}</strong></td>
          <td data-label="Runs">{{ y.runs }}</td>
          <td data-label="Distance">{{ y.distance_km }} km</td>
          <td data-label="Elevation">{{ y.elevation_m }} m</td>
          <td data-label="Avg Pace">{{ ypace }}/km</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

<!-- ─── Weekly Chart ──────────────────────────────────────────────── -->
{% if strava.weekly.size > 0 %}
<h2>Weekly Distance (last 16 weeks)</h2>

<div class="running-chart-container">
  <canvas id="weeklyChart" aria-label="Weekly running distance bar chart" role="img"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
<script>
(function () {
  var labels = [{% for w in strava.weekly %}"{{ w.label }}"{% unless forloop.last %},{% endunless %}{% endfor %}];
  var data   = [{% for w in strava.weekly %}{{ w.distance_km }}{% unless forloop.last %},{% endunless %}{% endfor %}];

  function isDark() {
    return document.documentElement.getAttribute("data-theme") === "dark";
  }

  function chartColors() {
    return {
      bar:    isDark() ? "rgba(252, 76, 2, 0.75)" : "rgba(252, 76, 2, 0.65)",
      border: isDark() ? "#FC4C02" : "#d93d00",
      grid:   isDark() ? "rgba(255,255,255,0.08)" : "rgba(0,0,0,0.08)",
      text:   isDark() ? "#c9d1d9" : "#333",
    };
  }

  function buildChart() {
    var ctx = document.getElementById("weeklyChart");
    if (!ctx) return;
    var c = chartColors();
    return new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [{
          label: "km",
          data: data,
          backgroundColor: c.bar,
          borderColor: c.border,
          borderWidth: 1,
          borderRadius: 3,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(ctx) { return ctx.parsed.y.toFixed(2) + " km"; }
            }
          }
        },
        scales: {
          x: {
            ticks: { color: c.text, font: { size: 11 } },
            grid:  { color: c.grid }
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: c.text,
              callback: function(v) { return v + " km"; }
            },
            grid: { color: c.grid }
          }
        }
      }
    });
  }

  var chartInstance = null;

  function init() {
    if (typeof Chart === "undefined") {
      setTimeout(init, 100);
      return;
    }
    chartInstance = buildChart();

    var observer = new MutationObserver(function () {
      if (chartInstance) { chartInstance.destroy(); }
      chartInstance = buildChart();
    });
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ["data-theme"] });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>
{% endif %}

<p class="running-sync-note">
  <i class="fas fa-sync-alt" aria-hidden="true"></i>
  Last synced: {{ strava.last_updated }}
</p>
